{% extends "base.html" %}

{% block extra_head %}
 <script type="text/javascript">
 $(function(){
    $('.resend').click(function(){
        var email_input = $(this).parent().find('input[name="resend-email"]');
        var email = email_input.val();
        $.getJSON('{% url account-resend-confirmation %}',{'email':email}, function(data){
                    if (data.success){
                        $('#resend-activation').
                            html('<p>An email has been sent to you with a link to reset your password.</p>');
                    } else {
                        email_input.parent().
                            append('<em>Enter correct email address</em>').
                            addClass('error-field');
                    }
                });
        return false;
    });

    $('.restore-pass').click(function(){
        var email_input = $(this).parent().find('input[name="restore-email"]');
        var email = email_input.val();
        $.getJSON('{% url account-send-restore-code %}',{'email':email}, function(data){
                    if (data.success){
                        $('#forgot-pass').
                            html('<p>An email has been sent to you with a link to reset your password.</p>');
                    } else {
                        email_input.parent().
                            append('<em>Enter correct email address</em>').
                            addClass('error-field');
                    }
                });
        return false;
    })
 })
    
function call_additinal_function(name){
    var pattr = new RegExp(name);
    if (pattr.test(document.location.href)){
        console.log('a[href="'+name+'"]');
        $('a[href="'+name+'"]').click();
    }
}
$(function(){
    call_additinal_function('#forgot-pass');
    call_additinal_function('#resend-activation');
})
 </script>
{% endblock %}

{% block container %}
    <div class="main-box login-box">
        <div class="box-t">&nbsp;</div>
        <div class="box-c">
            <div class="imgs-section"><img src="{{ STATIC_URL }}css/images/runner.jpg" alt="" /></div>
            <div class="login-form form">
                <form method="post" action="{% url account-login %}">{% csrf_token %}

                    <div class="login-option main-login-option">
                        <h3>Log In</h3>
                        {% if form.non_field_errors %}
                        {{ form.non_field_errors }}
                        {% endif %}
                        <input type="hidden" value="{{next|default:"/"}}" name="next">
                        <span class="field {% if form.errors %}error-field{% endif %}">
                            {{ form.email }}
                        </span>
                        <span class="field">
                            <input type="text" value="Password" class="fake-pass" title="Password" />
                            {{ form.password }}
                        </span>
                        <input type="submit" value="Log In" class="login-submit" />

                        <p>
                            <a href="#forgot-pass" class="login-option-select">Forgot Password?</a><br />
                            <a href="#resend-activation" class="login-option-select">Resend Activation</a>
                        </p>
                    </div>

                    <div class="login-option" id="resend-activation">
                        <h3>Resend Activation</h3>
                        <p>Enter your e-mail address below to get an activation link</p>
                        <span class="field"><input type="text" name="resend-email" value="Email Address" title="Email Address" class="blink" /></span>
                        <input type="submit" value="Resend" class="login-submit resend" />
                    </div>

                    <div class="login-option" id="forgot-pass">
                        <h3>Forgot your password?</h3>
                        <p>Enter your e-mail address below, and we'll e-mail instructions for setting a new one.</p>
                        <span class="field"><input type="text" name="restore-email" value="Email Address" title="Email Address" class="blink" /></span>
                        <input type="submit" value="Submit" class="login-submit restore-pass" />
                    </div>

                </form>
            </div>

            <div class="signup-block">
                <h3>Donâ€™t have an account?</h3>
                <a href="{% url account-registration %}" class="btn signup-btn">JOIN ACTIVEBUYS for FREE!</a>
            </div>

            <div class="cl">&nbsp;</div>
        </div>
        <div class="box-b">&nbsp;</div>
    </div>
{% endblock %}
